{% extends "main/base.html" %}
{% block title %}Al-Iman | My Students{% endblock %}
{% block content %}
{% comment %} <h1>{{ subject.name }}</h1> {% endcomment %}
<h1>Teacher: {{ subject.teacher_name }}</h1>
<h2>Subject/Class: {{ subject.subject_name }} {{ subject.subject_class }}</h2>
<table class='table'>
    <thead>
        <th>Student name</th>
        <th>Subject name</th>
        <th>First CA</th>
        <th>Second CA</th>
        <th>Third CA</th>
        <th>Exams</th>
        <th>Total</th>
    </thead>
    <tbody>
        {% comment %} {% for student in students %} {% endcomment %}
            {% for CA in continousassessment %}
                <tr>
                    <td>{{ CA.student.get_full_name }}</td>
                    <td>{{ CA.subject.subject_name }}</td>
                    <td contenteditable="true" oninput="handleInput(this)">{{ CA.first_ca }}</td>
                    <td contenteditable="true" oninput="handleInput(this)">{{ CA.second_ca }}</td>
                    <td contenteditable="true" oninput="handleInput(this)">{{ CA.exams }}</td>
                    <td contenteditable="true" oninput="handleInput(this)">{{ CA.total }}</td>
                </tr>
            {% endfor %}
            {% comment %} <span>{{ student.continousassessment_set.all }}</span> {% endcomment %}
        {% comment %} {% endfor %} {% endcomment %}
    </tbody>
</table>
<script>
    function handleInput(cell) {
        // Handle the input event here
        console.log("Content changed:", cell.innerText);

        // Send the updated content to the backend view
        sendDataToBackend(cell.innerText);
    }

    function sendDataToBackend(updatedContent) {
        // Create an XMLHttpRequest object
        var xhr = new XMLHttpRequest();

        // Configure it to send a POST request to your Django backend view
        xhr.open('POST', '/test/', true);
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

        // Define the data to be sent
        var data = 'updated_content=' + encodeURIComponent(updatedContent);

        // Set up the callback function to handle the response from the server
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                // Handle the response from the server if needed
                console.log('Server response:', xhr.responseText);
            }
        };

        // Send the data to the server
        xhr.send(data);
    }
</script>
{% endblock %}